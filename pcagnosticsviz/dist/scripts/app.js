/**
 * @license
 *
 * Copyright (c) 2015, University of Washington Interactive Data Lab.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * * Neither the name of the University of Washington Interactive Data Lab
 *   nor the names of its contributors may be used to endorse or promote products
 *   derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";angular.module("pcagnosticsviz",["vlui","ngSanitize","ngTouch","ngDragDrop","zeroclipboard","Chronicle","LocalStorageModule","720kb.tooltips","ngOrderObjectBy","angular-google-analytics"]).constant("_",window._).constant("vg",window.vg).constant("cql",window.cql).constant("ZSchema",window.ZSchema).constant("Tether",window.Tether).constant("Drop",window.Drop).constant("Blob",window.Blob).constant("URL",window.URL).constant("scagnostics",window.scagnostics).constant("jsondiffpatch",window.jsondiffpatch).config(["consts",function(e){window.vg.util.extend(e,{appId:"pcagnosticsviz",initialSpec:window.initialSpec||void 0,debugInList:!1,logLevel:"DEBUG",logToWebSql:!0,maxAnyShelf:4})}]).config(["vl",function(e){e.config.defaultConfig.countTitle="COUNT"}]).config(["uiZeroclipConfigProvider",function(e){e.setZcConf({swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"})}]).config(["localStorageServiceProvider",function(e){e.setPrefix("pcagnosticsviz")}]).config(["AnalyticsProvider","consts",function(e,t){t.embeddedData||e.setAccount({tracker:"UA-44428446-4",name:"pcagnosticsviz",trackEvent:!1})}]),angular.module("pcagnosticsviz").directive("vgSpecEditor",["Spec",function(e){return{templateUrl:"components/vgSpecEditor/vgSpecEditor.html",restrict:"E",scope:{},link:function(t){t.Spec=e}}}]),angular.module("pcagnosticsviz").directive("nullFilterDirective",["Spec",function(e){return{templateUrl:"components/nullfilterdirective/nullfilterdirective.html",restrict:"E",scope:{},link:function(t,n,r){t.Spec=e,t.updateFilter=function(){e.update()}}}}]),angular.module("pcagnosticsviz").directive("lyraExport",function(){return{template:'<a href="#" class="command" ng-click="export()">Export to lyra</a>',restrict:"E",replace:!0,scope:{},controller:["$scope","$timeout","Spec","Alerts",function(e,t,n,r){e["export"]=function(){var e=n.vgSpec;e||r.add("No vega spec present."),e.marks[0]["lyra.groupType"]="layer";var i="http://idl.cs.washington.edu/projects/lyra/app/",a=window.open(i,"_blank");t(function(){r.add("Please check whether lyra loaded the vega spec correctly. This feature is experimental and may not work.",5e3),a.postMessage({spec:e},i)},5e3)}}]}}),angular.module("pcagnosticsviz").directive("jsonInput",["JSON3",function(e){return{restrict:"A",require:"ngModel",scope:{},link:function(t,n,r,i){var a=function(t){return e.stringify(t,null,"  ",80)};i.$formatters.push(a)}}}]),angular.module("pcagnosticsviz").directive("guideMenu",function(){return{templateUrl:"components/guidemenu/guideMenu.html",restrict:"E",scope:{prop:"=",initialLimit:"<",priority:"<",marks:"<",props:"<",limit:"=",limitup:"="},replace:!0,controller:["$scope","PCAplot","Logger",function(e,t,n){var r=!0;e.limit=e.initialLimit||(e.prop.dim<1?10:5),console.log("dim: "+e.prop.dim+"limit: "+e.limit),e.limitup=e.prop.pos>e.limit?e.prop.pos-2:0,e.typeChange=function(){var i={level_explore:e.prop.dim,abtraction:e.prop.mark,visual_feature:e.prop.type};n.logInteraction(n.actions.FEATURE_SELECT,e.prop.type,{val:{PS:i,spec:this.vlSpec,query:this.query},time:(new Date).getTime()}),r=!0,t.updateSpec(e.prop),e.limit=e.initialLimit||(e.prop.dim<1?10:5),e.limitup=e.prop.pos>1?Math.min(e.limitup,e.prop.pos-2):0,console.log("dim: "+e.prop.dim+"limit: "+e.limit)},e.previewSlider=function(t){e.prop.pos=t+e.limitup;var r={level_explore:e.prop.dim,abtraction:e.prop.mark,visual_feature:e.prop.type};n.logInteraction(n.actions.FEATURE_QUICKNAVIGATION,t,{val:{PS:r,spec:this.vlSpec,query:this.query},time:(new Date).getTime()})},e.markChange=function(){var i={level_explore:e.prop.dim,abtraction:e.prop.mark,visual_feature:e.prop.type};n.logInteraction(n.actions.TYPEPLOT_SELECT,e.prop.mark,{val:{PS:i,spec:this.vlSpec,query:this.query},time:(new Date).getTime()}),r=!0,t.updateSpec(e.prop),e.limit=e.initialLimit||(e.prop.dim<1?10:5),e.limitup=e.prop.pos>1?Math.min(e.limitup,e.prop.pos-2):0,console.log("dim: "+e.prop.dim+"limit: "+e.limit)};var i=e.$watch("prop",function(t){e.limit=r?e.initialLimit||(e.prop.dim<1?10:5):e.limit,r=!1,e.limitup=Math.min(e.limitup,e.prop.pos>e.limit?e.prop.pos-2:0)},!0);e.increaseLimit=function(){e.limit+=4},e.$on("$destroy",function(){i()})}]}}),angular.module("pcagnosticsviz").directive("slideGraph",["PCAplot","Spec","Pills","Logger",function(e,t,n,r){return{templateUrl:"components/d3-slidegraph/slide-graph.html",replace:!0,scope:{charts:"<",pos:"=",postSelectAction:"&",limit:"=",limitup:"="},link:function(t,i){function a(){c.style("transform","translate3d(0,"+-(t.pos-t.limitup)*c.node().offsetHeight+"px,0)")}var o=t.charts.length,c=d3.select(".items-slider");t.$watch("pos",function(){a(),e.prop.mspec=t.charts[t.pos],t.limitup=Math.min(t.limitup,t.pos>t.limit?t.pos-2:0),a(),n.select(t.charts[t.pos].vlSpec)},!0),t.prev=function(){t.pos=Math.max(t.pos-1,0),t.limitup=Math.min(t.limitup,t.pos>t.limit?t.pos-2:0),r.logInteraction(r.actions.MAINVIEW_NAVIGATION,t.pos,{val:{spec:this.charts[t.pos].vlSpec,query:this.charts[t.pos].query},time:(new Date).getTime()}),a()},t.next=function(){t.pos=Math.min(t.pos+1,o-1),t.pos>t.limit-1&&(t.limitup=Math.min(t.limitup,t.pos>t.limit?t.pos-2:0),t.limit=t.pos+2),r.logInteraction(r.actions.MAINVIEW_NAVIGATION,t.pos,{val:{spec:this.charts[t.pos].vlSpec,query:this.charts[t.pos].query},time:(new Date).getTime()}),a()},t.$on("$destroy",function(){console.log("guideplot destroyed"),t.charts=null})}}}]),angular.module("pcagnosticsviz").directive("slideCom",function(){return{templateUrl:"components/d3-slidegraph/slide-com.html",replace:!0,scope:{chart:"="},link:function(e,t){}}}),angular.module("pcagnosticsviz").directive("guidePlot",["PCAplot",function(e){return{templateUrl:"components/d3-guideplot/guide-plot.html",replace:!0,restrict:"E",scope:{pcaDefs:"<"},link:function(e){}}}]),angular.module("pcagnosticsviz").directive("gPlot",["PCAplot",function(e){return{templateUrl:"components/d3-guideplot/gplot.html",replace:!0,scope:{pcaDef:"="},link:function(t,n){t.PCAplot=e,d3.select(n[0]).select("svg").attr("width",n.width()).attr("height",n.height()),e.plotguide(d3.select(n[0]).select("svg"),t.pcaDef[0],t.pcaDef[1])},controller:["$scope",function(e){console.log("me")}]}}]),function(){function e(e){return[0,e.length-1]}function t(e){return[d3.quantile(e,.25),d3.quantile(e,.5),d3.quantile(e,.75)]}d3.box=function(){function n(e){e.each(function(e,t){var n=e[1].sort(d3.ascending),c=d3.select(this),d=n.length,f=n[0],m=n[d-1],g=n.quartiles=s(n),h=l&&l.call(this,n,t),v=h&&h.map(function(e){return n[e]}),y=h?d3.range(0,h[0]).concat(d3.range(h[1]+1,d)):d3.range(d),S=d3.scale.linear().domain(o&&o.call(this,n,t)||[f,m]).range([i,0]),b=this.__chart__||d3.scale.linear().domain([0,1/0]).range(S.range());this.__chart__=S;var E=c.selectAll("line.center").data(v?[v]:[]);E.enter().insert("line","rect").attr("class","center").attr("x1",r/2).attr("y1",function(e){return b(e[0])}).attr("x2",r/2).attr("y2",function(e){return b(e[1])}).style("opacity",1e-6).transition().duration(a).style("opacity",1).attr("y1",function(e){return S(e[0])}).attr("y2",function(e){return S(e[1])}),E.transition().duration(a).style("opacity",1).attr("y1",function(e){return S(e[0])}).attr("y2",function(e){return S(e[1])}),E.exit().transition().duration(a).style("opacity",1e-6).attr("y1",function(e){return S(e[0])}).attr("y2",function(e){return S(e[1])}).remove();var k=c.selectAll("rect.box").data([g]);k.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(e){return b(e[2])}).attr("width",r).attr("height",function(e){return b(e[0])-b(e[2])}).transition().duration(a).attr("y",function(e){return S(e[2])}).attr("height",function(e){return S(e[0])-S(e[2])}),k.transition().duration(a).attr("y",function(e){return S(e[2])}).attr("height",function(e){return S(e[0])-S(e[2])});var w=c.selectAll("line.median").data([g[1]]);w.enter().append("line").attr("class","median").attr("x1",0).attr("y1",b).attr("x2",r).attr("y2",b).transition().duration(a).attr("y1",S).attr("y2",S),w.transition().duration(a).attr("y1",S).attr("y2",S);var x=c.selectAll("line.whisker").data(v||[]);x.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",b).attr("x2",0+r).attr("y2",b).style("opacity",1e-6).transition().duration(a).attr("y1",S).attr("y2",S).style("opacity",1),x.transition().duration(a).attr("y1",S).attr("y2",S).style("opacity",1),x.exit().transition().duration(a).attr("y1",S).attr("y2",S).style("opacity",1e-6).remove();var A=c.selectAll("circle.outlier").data(y,Number);A.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",r/2).attr("cy",function(e){return b(n[e])}).style("opacity",1e-6).transition().duration(a).attr("cy",function(e){return S(n[e])}).style("opacity",1),A.transition().duration(a).attr("cy",function(e){return S(n[e])}).style("opacity",1),A.exit().transition().duration(a).attr("cy",function(e){return S(n[e])}).style("opacity",1e-6).remove();var C=u||S.tickFormat(8),T=c.selectAll("text.box").data(g);1==p&&T.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(e,t){return 1&t?6:-6}).attr("x",function(e,t){return 1&t?+r:0}).attr("y",b).attr("text-anchor",function(e,t){return 1&t?"start":"end"}).text(C).transition().duration(a).attr("y",S),T.transition().duration(a).text(C).attr("y",S);var D=c.selectAll("text.whisker").data(v||[]);1==p&&D.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",r).attr("y",b).text(C).style("opacity",1e-6).transition().duration(a).attr("y",S).style("opacity",1),D.transition().duration(a).text(C).attr("y",S).style("opacity",1),D.exit().transition().duration(a).attr("y",S).style("opacity",1e-6).remove()}),d3.timer.flush()}var r=1,i=1,a=0,o=null,c=Number,l=e,s=t,p=!0,u=null;return n.width=function(e){return arguments.length?(r=e,n):r},n.height=function(e){return arguments.length?(i=e,n):i},n.tickFormat=function(e){return arguments.length?(u=e,n):u},n.duration=function(e){return arguments.length?(a=e,n):a},n.domain=function(e){return arguments.length?(o=null==e?e:d3.functor(e),n):o},n.value=function(e){return arguments.length?(c=e,n):c},n.whiskers=function(e){return arguments.length?(l=e,n):l},n.showLabels=function(e){return arguments.length?(p=e,n):p},n.quartiles=function(e){return arguments.length?(s=e,n):s},n}}();var PCA=function(){function e(e){var n=t(e);return n.map(function(t){return d3.sum(t)/e.length})}function t(e){return d3.range(e[0].length).map(function(t){return e.map(function(e){return e[t]})})}function n(e,n){return e.map(function(e){return t(n).map(function(t){return d3.sum(d3.zip(e,t).map(function(e){return e[0]*e[1]}))})})}function r(e){return d3.range(e.length).map(function(t){return d3.range(e.length).map(function(n){return t===n?e[t]:0})})}function i(e,t){return d3.range(e).map(function(e){return d3.range(t).map(function(){return 0})})}function a(e,t){return e.map(function(e){return e.map(function(e){return e<t?0:e})})}function o(e,t){return d3.zip(e,t).map(function(e){return d3.zip(e[0],e[1]).map(function(e){return e[0]===e[1]})}).map(function(e){return e.reduce(function(e,t){return e*t})}).reduce(function(e,t){return e*t})}function c(t){e(t);return l(e(s(t,t)))}function l(e){return e.map(function(e){return Math.sqrt(e)})}function s(e,t){return d3.zip(e,t).map(function(e){return"number"==typeof e[0]?e[0]*e[1]:d3.zip(e[0],e[1]).map(function(e){return e[0]*e[1]})})}function p(e,t){return console.assert(e.length===t.length,"dim(x) == dim(y)"),d3.zip(e,t).map(function(e){return"number"==typeof e[0]?e[0]-e[1]:d3.zip(e[0],e[1]).map(function(e){return e[0]-e[1]})})}function u(e,t){return console.assert(e.length===t.length,"dim(x) == dim(y)"),d3.zip(e,t).map(function(e){return 0!==e[1]?e[0]/e[1]:0})}function d(t,n,r){if(n){var i=e(t);t=t.map(function(e){return p(e,i)})}if(r){var a=c(t);t=t.map(function(e){return u(e,a)})}return t}function f(e){function t(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):0===t?e:t*Math.sqrt(1+e*e/t/t)}var n,r=Math.pow(2,-52),a=1e-64/r,o=50,c=0,l=0,s=0,p=0,u=0,d=e.map(function(e){return e.slice(0)}),f=d.length,m=d[0].length;console.assert(f>=m,"Need more rows than columns");var g=d3.range(m).map(function(){return 0}),h=d3.range(m).map(function(){return 0}),v=i(m,m),y=0,S=0,b=0,E=0,k=0,w=0,x=0;for(l=0;l<m;l++){for(g[l]=S,x=0,u=l+1,s=l;s<f;s++)x+=d[s][l]*d[s][l];if(x<=a)S=0;else for(y=d[l][l],S=Math.sqrt(x),y>=0&&(S=-S),b=y*S-x,d[l][l]=y-S,s=u;s<m;s++){for(x=0,p=l;p<f;p++)x+=d[p][l]*d[p][s];for(y=x/b,p=l;p<f;p++)d[p][s]+=y*d[p][l]}for(h[l]=S,x=0,s=u;s<m;s++)x+=d[l][s]*d[l][s];if(x<=a)S=0;else{for(y=d[l][l+1],S=Math.sqrt(x),y>=0&&(S=-S),b=y*S-x,d[l][l+1]=y-S,s=u;s<m;s++)g[s]=d[l][s]/b;for(s=u;s<f;s++){for(x=0,p=u;p<m;p++)x+=d[s][p]*d[l][p];for(p=u;p<m;p++)d[s][p]+=x*g[p]}}k=Math.abs(h[l])+Math.abs(g[l]),k>E&&(E=k)}for(l=m-1;l!==-1;l+=-1){if(0!==S){for(b=S*d[l][l+1],s=u;s<m;s++)v[s][l]=d[l][s]/b;for(s=u;s<m;s++){for(x=0,p=u;p<m;p++)x+=d[l][p]*v[p][s];for(p=u;p<m;p++)v[p][s]+=x*v[p][l]}}for(s=u;s<m;s++)v[l][s]=0,v[s][l]=0;v[l][l]=1,S=g[l],u=l}for(l=m-1;l!==-1;l+=-1){for(u=l+1,S=h[l],s=u;s<m;s++)d[l][s]=0;if(0!==S){for(b=d[l][l]*S,s=u;s<m;s++){for(x=0,p=u;p<f;p++)x+=d[p][l]*d[p][s];for(y=x/b,p=l;p<f;p++)d[p][s]+=y*d[p][l]}for(s=l;s<f;s++)d[s][l]=d[s][l]/S}else for(s=l;s<f;s++)d[s][l]=0;d[l][l]+=1}for(r*=E,p=m-1;p!==-1;p+=-1)for(var A=0;A<o;A++){var C=!1;for(u=p;u!==-1;u+=-1){if(Math.abs(g[u])<=r){C=!0;break}if(Math.abs(h[u-1])<=r)break}if(!C){c=0,x=1;var T=u-1;for(l=u;l<p+1&&(y=x*g[l],g[l]=c*g[l],!(Math.abs(y)<=r));l++)for(S=h[l],b=t(y,S),h[l]=b,c=S/b,x=-y/b,s=0;s<f;s++)k=d[s][T],w=d[s][l],d[s][T]=k*c+w*x,d[s][l]=-k*x+w*c}if(w=h[p],u===p){if(w<0)for(h[p]=-w,s=0;s<m;s++)v[s][p]=-v[s][p];break}for(console.assert(A<o-1,"Error: no convergence."),E=h[u],k=h[p-1],S=g[p-1],b=g[p],y=((k-w)*(k+w)+(S-b)*(S+b))/(2*b*k),S=t(y,1),y=y<0?((E-w)*(E+w)+b*(k/(y-S)-b))/E:((E-w)*(E+w)+b*(k/(y+S)-b))/E,c=1,x=1,l=u+1;l<p+1;l++){for(S=g[l],k=h[l],b=x*S,S=c*S,w=t(y,b),g[l-1]=w,c=y/w,x=b/w,y=E*c+S*x,S=-E*x+S*c,b=k*x,k*=c,s=0;s<m;s++)E=v[s][l-1],w=v[s][l],v[s][l-1]=E*c+w*x,v[s][l]=-E*x+w*c;for(w=t(y,b),h[l-1]=w,c=y/w,x=b/w,y=c*S+x*k,E=-x*S+c*k,s=0;s<f;s++)k=d[s][l-1],w=d[s][l],d[s][l-1]=k*c+w*x,d[s][l]=-k*x+w*c}g[u]=0,g[p]=y,h[p]=E}for(l=0;l<h.length;l++)h[l]<r&&(h[l]=0);for(l=0;l<m;l++)for(s=l-1;s>=0;s--)if(h[s]<h[l]){for(c=h[s],h[s]=h[l],h[l]=c,p=0;p<d.length;p++)n=d[p][l],d[p][l]=d[p][s],d[p][s]=n;for(p=0;p<v.length;p++)n=v[p][l],v[p][l]=v[p][s],v[p][s]=n;l=s}return{U:d,S:h,V:v}}function m(e,t){var c=f(e),l=c.U,s=r(c.S),u=c.V,d=n(e,u),m=n(l,s),g=a(p(d,m),1e-12),h=i(g.length,g[0].length);console.assert(o(g,h),"svd and eig ways must be the same.");var v=[0,1];for(var y in c.S)c.S[y]>=c.S[v[0]]?v[0]=parseInt(y):c.S[y]>=c.S[v[1]]&&(v[1]=parseInt(y));return[m,u,v]}this.scale=d,this.pca=m};
// Copyright (c) 2013 Justin Palmer
// ES6 / D3 v4 Adaption Copyright (c) 2016 Constantin Gavrilete
// Removal of ES6 for D3 v4 Adaption Copyright (c) 2016 David Gotz
//
// Tooltips for d3.js SVG visualizations
d3.functor=function(e){return"function"==typeof e?e:function(){return e}},d3.tip=function(){function e(e){b=f(e),E=b.createSVGPoint(),document.body.appendChild(S)}function t(){return"n"}function n(){return[0,0]}function r(){return" "}function i(){var e=g();return{top:e.n.y-S.offsetHeight,left:e.n.x-S.offsetWidth/2}}function a(){var e=g();return{top:e.s.y,left:e.s.x-S.offsetWidth/2}}function o(){var e=g();return{top:e.e.y-S.offsetHeight/2,left:e.e.x}}function c(){var e=g();return{top:e.w.y-S.offsetHeight/2,left:e.w.x-S.offsetWidth}}function l(){var e=g();return{top:e.nw.y-S.offsetHeight,left:e.nw.x-S.offsetWidth}}function s(){var e=g();return{top:e.ne.y-S.offsetHeight,left:e.ne.x}}function p(){var e=g();return{top:e.sw.y,left:e.sw.x-S.offsetWidth}}function u(){var e=g();return{top:e.se.y,left:e.e.x}}function d(){var e=d3.select(document.createElement("div"));return e.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),e.node()}function f(e){return e=e.node(),"svg"===e.tagName.toLowerCase()?e:e.ownerSVGElement}function m(){return null===S&&(S=d(),document.body.appendChild(S)),d3.select(S)}function g(){for(var e=k||d3.event.target;"undefined"==typeof e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var t={},n=e.getScreenCTM(),r=e.getBBox(),i=r.width,a=r.height,o=r.x,c=r.y;return E.x=o,E.y=c,t.nw=E.matrixTransform(n),E.x+=i,t.ne=E.matrixTransform(n),E.y+=a,t.se=E.matrixTransform(n),E.x-=i,t.sw=E.matrixTransform(n),E.y-=a/2,t.w=E.matrixTransform(n),E.x+=i,t.e=E.matrixTransform(n),E.x-=i/2,E.y-=a/2,t.n=E.matrixTransform(n),E.y+=a,t.s=E.matrixTransform(n),t}var h=t,v=n,y=r,S=d(),b=null,E=null,k=null;e.show=function(){var t=Array.prototype.slice.call(arguments);t[t.length-1]instanceof SVGElement&&(k=t.pop());var n,r=y.apply(this,t),i=v.apply(this,t),a=h.apply(this,t),o=m(),c=x.length,l=document.documentElement.scrollTop||document.body.scrollTop,s=document.documentElement.scrollLeft||document.body.scrollLeft;for(o.html(r).style("position","absolute").style("opacity",1).style("pointer-events","all");c--;)o.classed(x[c],!1);return n=w[a].apply(this),o.classed(a,!0).style("top",n.top+i[0]+l+"px").style("left",n.left+i[1]+s+"px"),e},e.hide=function(){var t=m();return t.style("opacity",0).style("pointer-events","none"),e},e.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return m().attr(t);var r=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(m(),r),e},e.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return m().style(t);var r=Array.prototype.slice.call(arguments);if(1===r.length){var i=r[0];Object.keys(i).forEach(function(e){return d3.selection.prototype.style.apply(m(),[e,i[e]])})}return e},e.direction=function(t){return arguments.length?(h=null==t?t:d3.functor(t),e):h},e.offset=function(t){return arguments.length?(v=null==t?t:d3.functor(t),e):v},e.html=function(t){return arguments.length?(y=null==t?t:d3.functor(t),e):y},e.destroy=function(){return S&&(m().remove(),S=null),e};var w={n:i,s:a,e:o,w:c,nw:l,ne:s,sw:p,se:u},x=Object.keys(w);return e},angular.module("pcagnosticsviz").component("biPlot",{templateUrl:"components/d3-biplot/bi-plot.html",controller:["$scope",function(e){d3.selectAll(".background-biplot").style("fill","#ffffff").attr("width",$(".biplot").width()).attr("height",$(".biplot").width())}]}),angular.module("pcagnosticsviz").directive("cqlQueryEditor",["Spec",function(e){return{templateUrl:"components/cqlQueryEditor/cqlQueryEditor.html",restrict:"E",scope:{},link:function(t){t.Spec=e}}}]),angular.module("pcagnosticsviz").directive("configurationEditor",function(){return{templateUrl:"components/configurationeditor/configurationeditor.html",restrict:"E",scope:{},controller:["$scope","Config",function(e,t){e.Config=t}]}}),angular.module("pcagnosticsviz").service("Wildcards",["ANY","vl","cql","Dataset","Alerts",function(e,t,n,r,i){function a(){u.list=[{title:"Categorical Fields",field:"?",type:{"enum":[t.type.NOMINAL,t.type.ORDINAL]},immutable:!0},{title:"Temporal Fields",field:"?",type:t.type.TEMPORAL,immutable:!0},{title:"Quantitative Fields",field:"?",type:t.type.QUANTITATIVE,immutable:!0}]}function o(e){var t={title:null,field:{"enum":[]},type:{"enum":[]}};return l(t,e,!0),u.list.push(t),t}function c(e,t){e.indexOf(t)===-1&&e.push(t)}function l(e,a,o){if(o)n.enumSpec.isEnumSpec(a.type)?a.type["enum"].forEach(function(t){c(e.type["enum"],t)}):c(e.type["enum"],a.type);else if(n.enumSpec.isEnumSpec(a.type)){var l=t.util.some(a.type["enum"],function(n){return!t.util.contains(e.type["enum"],n)});if(l)return void i.add("Cannot create a wildcard that mixes multiple types")}else if(!t.util.contains(e.type["enum"],a.type))return void i.add("Cannot create a wildcard that mixes multiple types");return n.enumSpec.isEnumSpec(a.field)?a.field["enum"]?a.field["enum"].forEach(function(t){c(e.field["enum"],t)}):r.schema.fieldSchemas.forEach(function(n){(e.type["enum"]?t.util.contains(e.type["enum"],n.type):n.type===e.type)&&c(e.field["enum"],n.field)}):"count"===a.aggregate?(e.aggregate={"enum":[void 0,"count"]},c(e.field["enum"],"*")):c(e.field["enum"],a.field),e}function s(e){var t=u.list.indexOf(e);u.list.splice(t,1)}function p(e,t){var n=e.field["enum"].splice(t,1);"*"===n&&delete e.aggregate,0===e.field["enum"].length&&s(e)}var u={list:null,addItem:o,addField:l,removeItem:s,removeField:p};return a(),r.onUpdate.push(a),u}]),angular.module("pcagnosticsviz").service("Spec",["ANY","_","vg","vl","cql","util","ZSchema","consts","NotifyingService","Alerts","Alternatives","Chart","Config","Dataset","Logger","Pills","Schema","Wildcards","FilterManager","PCAplot",function(e,t,n,r,i,a,o,c,l,s,p,u,d,f,m,g,h,v,y,S){function b(){return{data:d.data,transform:{filterInvalid:void 0},mark:e,encoding:P.reduce(function(e,t){return e[t]={},e},{}),config:d.config,groupBy:"auto",autoAddCount:!1}}function E(e){for(var r in e)t.isObject(e[r])&&E(e[r]),(null===e[r]||void 0===e[r]||t.isObject(e[r])&&0===n.util.keys(e[r]).length&&"bin"!==r||e[r]===[])&&delete e[r]}function k(e){var n=a.duplicate(e),i=null;if(n){i=(n.transform||{}).filter;var o=t.omit(n.transform||{},"filter");n=t.omit(n,"transform"),o&&(n.transform=o)}var c=r.util.mergeDeep(b(),n);return c.transform.filter=y.reset(i),c}function w(e,t){if(!e)return t;var n=e.enumSpecIndex;return 0===a.keys(n.encodingIndicesByProperty).length}function x(t,r){if(r){t=a.duplicate(t),t.transform&&t.transform.filter&&delete t.transform.filter;var o=y.getVlFilter();o&&(t.transform=t.transform||{},t.transform.filter=o)}return{data:d.data,mark:t.mark===e?"?":t.mark,type:t.type,transform:t.transform,encodings:n.util.keys(t.encoding).reduce(function(e,r){var a=n.util.extend({channel:g.isAnyChannel(r)?"?":r},t.encoding[r],{title:void 0});return i.enumSpec.isEnumSpec(a.field)&&(a.field={name:"f"+r,"enum":a.field["enum"]}),e.push(a),e},[]),config:t.config}}function A(n){var o=a.duplicate(n.spec),c=b();i.enumSpec.isEnumSpec(o.mark)?c.mark=e:c.mark=o.mark,c.transform=t.omit(o.transform||{},"filter"),c.transform.filter=y.reset(o.transform.filter);var l=0,s=o.encodings.reduce(function(t,n){var r=i.enumSpec.isEnumSpec(n.channel)?e+l++:n.channel;return t[r]=n,t},{});return c.encoding=r.util.mergeDeep(c.encoding,s),c.config=o.config,c.groupBy="auto",c.orderBy=o.orderBy,c.autoAddCount=(n.config||{}).autoAddCount,c}function C(e,t){for(var n=x(e,t),r=!1,a=!1,o=!1,c=0;c<n.encodings.length;c++){var l=n.encodings[c];l.autoCount!==!1&&(i.enumSpec.isEnumSpec(l.field)&&(r=!0),(i.enumSpec.isEnumSpec(l.aggregate)||i.enumSpec.isEnumSpec(l.bin)||i.enumSpec.isEnumSpec(l.timeUnit))&&(a=!0),i.enumSpec.isEnumSpec(l.channel)&&(o=!0))}var s=e.groupBy;return"auto"===e.groupBy&&(s=_.autoGroupBy=r?a?"fieldTransform":"field":"encoding"),{spec:n,groupBy:s,orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{omitTableWithOcclusion:!1,autoAddCount:(r||a||o)&&e.autoAddCount}}}function T(e){return{}}function D(e,t,n){var i=t.type,a=g.isAnyChannel(n)?{measure:!0,dimension:!0}:r.channel.getSupportedRole(n),o=a.dimension&&!a.measure;t.field&&o?"count"===t.aggregate?t={}:i!==r.type.QUANTITATIVE||t.bin?i!==r.type.TEMPORAL||t.timeUnit||(t.timeUnit=c.defaultTimeFn):(t.aggregate=void 0,t.bin={maxbins:r.bin.MAXBINS_DEFAULT}):t.field||(t={});var l=T(n),s=h.getChannelSchema(n).properties;for(var p in s)t[p]&&("value"===p&&t.field?delete l[p]:l[p]=t[p]);e[n]=l}function M(e){var t=g.getNextAnyChannelId();null!==t&&D(e,{},t)}var P=t.keys(h.schema.definitions.Encoding.properties).concat([e+0]),_={spec:null,previewedSpec:null,emptySpec:b(),query:null,isSpecific:!0,charts:null,chart:u.getChart(null),isEmptyPlot:!0,alternatives:[],histograms:null,instantiate:b,groupByLabel:{field:"Showing views with different fields",fieldTransform:"Showing views with different fields and transforms",encoding:"Showing views with different encodings"},autoGroupBy:null,isSelected:!1};return _._removeEmptyFieldDefs=function(e){e.encoding=t.omit(e.encoding,function(t,n){return!t||void 0===t.field&&void 0===t.value||e.mark&&!r.channel.supportMark(n,e.mark)})},_.parseSpec=function(e){_.spec=k(e)},_.reset=function(e){var t=b();t.transform.filter=y.reset(null,e),_.spec=t},_.update=function(e){if(null!=_.previewedSpec&&!_.isSelected)return _;try{S.calscagnotic(f.schema.fieldSchemas.map(function(e){return e.field}))}catch(r){}var a=0,o=[];for(var c in e.encoding)void 0!==e.encoding[c].field&&"*"!==e.encoding[c].field&&(a++,o.push(e.encoding[c].field));a=a<1?0:a-1;var l;0==a&&(l=f.data),1==a&&(l=f.schema.fieldSchemas.map(function(e){var t={field:e.field};return t[e.field]=e.scag,t})),S.dim!=a&&a<2&&(S.firstrun=!0),S.dim=a,S.plot(l,a),e=S.checkRender(e,o),e=t.cloneDeep(e||_.spec),_._removeEmptyFieldDefs(e),E(e),e.transform&&e.transform.filter&&delete e.transform.filter,e.transform=e.transform||{};var s=y.getVlFilter();if((s||e.transform.filter)&&(e.transform.filter=s),"encoding"in e||(e.encoding={}),"config"in e||(e.config={}),n.util.extend(e.config,d.small()),!f.schema)return _;var p=_.cleanQuery=C(e);if(t.isEqual(p,_.oldCleanQuery))return _;_.oldCleanQuery=t.cloneDeep(p);var m=i.query(p,f.schema);_.query=m.query;var g=m.result.getTopSpecQueryModel();return _.isEmptyPlot=!_.query||0===_.query.spec.encodings.length,_.isSpecific=w(g,_.isEmptyPlot),_.alternatives=[],_.isSpecific||_.isEmptyPlot?(_.chart=u.getChart(g),_.charts=null,f.schema&&p.spec.encodings.length>0&&S.madeprop(_.chart)):g?_.chart=u.getChart(null):(_.charts=null,_.chart=null),_.isSelected=!1,_},_.preview=function(e,t,n){if(e){if(!t)return;var r=t.vlSpec;_.previewedSpec=k(r),m.logInteraction(m.actions.SPEC_PREVIEW_ENABLED,t.shorthand,{list:n})}else null!==_.previewedSpec&&(_.previewedSpec=null,m.logInteraction(m.actions.SPEC_PREVIEW_DISABLED,t.shorthand,{list:n}))},_.previewQuery=function(e,t,n){if(e){if(!t)return;_.previewedSpec=A(t),m.logInteraction(m.actions.SPEC_PREVIEW_ENABLED,i.query.shorthand.spec(t.spec),{list:n})}else null!==_.previewedSpec&&(_.previewedSpec=null,m.logInteraction(m.actions.SPEC_PREVIEW_DISABLED,i.query.shorthand.spec(t.spec),{list:n}))},g.listener={set:function(e,t){D(_.spec.encoding,t,e)},remove:function(e){if(g.isAnyChannel(e)){delete _.spec.encoding[e];var t=g.getEmptyAnyChannelId();t||M(_.spec.encoding)}else D(_.spec.encoding,{},e)},add:function(n){var r=i.enumSpec.isEnumSpec(_.cleanQuery.spec.mark);if(m.logInteraction(m.actions.ADD_FIELD,n,{from:i.query.shorthand.spec(_.query.spec)}),_.isSpecific&&!i.enumSpec.isEnumSpec(n.field)){var a=_.cleanQuery.spec,o=t.extend({},n,{channel:i.enumSpec.SHORT_ENUM_SPEC},"count"===n.aggregate?{}:{aggregate:i.enumSpec.SHORT_ENUM_SPEC,bin:i.enumSpec.SHORT_ENUM_SPEC,timeUnit:i.enumSpec.SHORT_ENUM_SPEC});a.encodings.push(o);var c={spec:a,groupBy:["field","aggregate","bin","timeUnit","stack"],orderBy:"aggregationQuality",chooseBy:"effectiveness",config:{omitTableWithOcclusion:!1}},l=i.query(c,f.schema),p=l.result,u=p.getTopSpecQueryModel();if(!u)return void s.add("Cannot automatically adding this field anymore");var d=u.toSpec();r&&(d.mark=e),_.parseSpec(d)}else{var h=t.clone(_.spec.encoding),v=g.getEmptyAnyChannelId();if(!v)return void s.add("You cannot add too many fields to the wildcard shelves!");D(h,t.clone(n),v),M(h),_.spec.encoding=h}},select:function(e){_.isSelected=!0,_.parseSpec(e)},selectQuery:function(e){_.spec=A(e)},parse:function(e){_.parseSpec(e)},preview:_.preview,previewQuery:_.previewQuery,update:function(e){return _.update(e)},reset:function(){_.reset()},dragDrop:function(e,n){var r=t.clone(_.spec.encoding);n&&(g.isAnyChannel(n)&&!g.isAnyChannel(e)?delete r[n]:D(r,g.get(n)||{},n));var i=!(r[e]||{}).field;D(r,g.get(e)||{},e),g.isAnyChannel(e)&&i&&(n&&g.isAnyChannel(n)||M(r)),_.spec.encoding=r},rescale:function(e,t){var n=_.spec.encoding[e];n.scale?n.scale.type=t:n.scale={type:t}},sort:function(e,t){_.spec.encoding[e].sort=t},transpose:function(){u.transpose(_.spec)},isEnumeratedChannel:function(e){return _.spec.encoding[e]&&!_.spec.encoding[e].field},isEnumeratedField:function(e){return _.spec.encoding[e]&&i.enumSpec.isEnumSpec(_.spec.encoding[e].field)},toggleFilterInvalid:function(){_.spec.transform.filterInvalid=!_.spec.transform.filterInvalid||void 0},addWildcard:v.addItem,addWildcardField:v.addField,removeWildcard:v.removeItem,removeWildcardField:v.removeField},_.reset(),f.onUpdate.push(function(){_.reset(!0)}),_}]),angular.module("pcagnosticsviz").factory("NotifyingService",["$rootScope",function(e){return{subscribe:function(t,n){var r=e.$on("notifying-service-event",n);t.$on("$destroy",r)},notify:function(){e.$emit("notifying-service-event")}}}]),angular.module("pcagnosticsviz").factory("PCAplot",["ANY","Dataset","_","vg","vl","cql","ZSchema","Logger","consts","FilterManager","Pills","NotifyingService","Alternatives","Chart","Config","Schema","util","GuidePill",function(e,t,n,r,i,a,o,c,l,s,p,u,d,f,m,g,h,v){function y(){return{data:m.data,transform:{},mark:"bar",encoding:V.reduce(function(e,t){return e[t]={},e},{}),config:m.config,groupBy:"auto",orderBy:"auto",autoAddCount:!1,type:"auto"}}function S(e,t,n){var r=e.x,i=e.y,a=t.x,o=t.y,c=n.x,l=n.y,s=a-r,p=o-i,u=s*s+p*p,d=((c-r)*s+(l-i)*p)/u,f=r+d*s,m=i+d*p,f=r+d*s,m=i+d*p;return{x:f,y:m}}function b(e,t,n){var r=Math.sqrt(e*e+t*t),i=Math.atan(t/e);return e<0&&(i+=Math.PI),{x:r*Math.cos(i+n),y:r*Math.sin(i+n)}}function E(e){var t={};for(var n in e[0])t[n]=[];var r=Array.from(e);e.forEach(function(e){for(var n in e)void 0==t[n].find(function(t){return t.key==[e[n]]})&&t[n].push({key:e[n]})});for(var n in t)t[n].sort(function(e,t){return e.key<t.key?-1:1}),t[n].forEach(function(e,t){null==e.key?e.newindex=0:isNaN(parseFloat(e.key))?e.newindex=t:e.newindex=parseFloat(e.key)});var i=e.map(function(e,n){return Object.keys(e).map(function(e){return t[e].find(function(t){return t.key==r[n][e]}).newindex})});return i}function k(e,t,n){switch(e){case"bar":q(t,n);break;case"tick":O(t,n);break;case"area":B(t,n);break;case"boxplot":U(t,n);break;case"point":R(t,n);break;case"hexagon":R(t,n,"hexagon");break;case"leader":R(t,n,"leader");break;case"contour":R(t,n,"contour");break;case"scatter3D":L(t,n);break;case"scatter3D-point":L(t,n,"point");break;case"scatter3D-evenbin":L(t,n,"evenbin");break;case"scatter3D-contour":L(t,n,"contour");break;case"radar":F(t,n);break;case"radar-evenbin":F(t,n,"evenbin");break;case"radar-leader":F(t,n,"leader")}}function w(e,t,n,r,i,a){for(var o=t;o<e.length;o++){var c=(a||[]).concat(e[o]);n===r?i.push(c):w(e,t+1,n+1,r,i,c)}return i}function x(e,r,i){void 0===i&&(i=t.schema.fieldSchemas);var o=o=n.cloneDeep(y()||K.spec);o.type=r,o.config={cell:{width:K.dim?100:200,height:K.dim?100:30},axis:{grid:!1,ticks:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0}},o.config.typer={type:r,val:N(r,e)},k(_(r,K.dim),o,e);var c=Q(o,void 0,r),l=a.query(c,t.schema);K.query=l.query;var s=l.result.getTopSpecQueryModel();K.chart=f.getChart(s),K.chart.vlSpec.config.displayModeBar=!1,K.chart.vlSpec.config.colorbar=!1,K.chart.vlSpec.config.staticPlot=!0,K.chart.query={groupBy:"encoding",orderBy:["feature"],chooseBy:["abstraction"]},K.chart.prop={mspec:n.cloneDeep(K.chart),type:r,mark:o.mark,ranking:I(r),plot:te,dim:K.dim,fieldDefs:e},K.chart.guideon=J,K.charts.push(K.chart)}function A(e,n){var r={};return r.mark=e.mark,r.dim=K.dim,r.type=e.type,r.fieldDefs=n.map(function(e){return t.schema.fieldSchema(e)}),r}function C(e,t){return void 0===Z[t].marks.find(function(t){return t===e})}function T(e,t){return(t||K.prop.charts).findIndex(function(t){var n=0;return t.fieldSet.forEach(function(t){e.forEach(function(e){n+=t.field===e})}),n>e.length||n===e.length})}function D(e,t,n){n=void 0===n?t+1:n;var r=0;return Z[t].marks.forEach(function(t,n){if(t==e)return void(r=n)}),Z[t+1].marks[r>Z[n].marks.length-1?0:r]}function M(e,t,n){if(void 0===e)return Z[n].types[0];var r=0;return Z[t].types.forEach(function(t,n){if(t===e)return void(r=n)}),Z[n].types[r>Z[n].types.length-1?0:r]}function P(e,t,n){switch(t||this.option){case"random":var r=ee;return ee=ee>2?0:ee+1,this.marks[r];case"manual":return this.marks[n];default:var n=this.types.findIndex(function(t){return t===e});return this.marks[n>this.marks.length-1?0:n]}}function _(e,t){return Z[t].getmark(e,null)}function I(e){switch(e){case"PC1":return function(e,t){return Math.abs(e.extrastat.pc1)<Math.abs(t.extrastat.pc1)?1:-1};case"skewness":return function(e,t){return Math.abs(e.stats.modeskew)<Math.abs(t.stats.modeskew)?1:-1};case"PC2":return function(e,t){return Math.abs(e.extrastat.pc2)<Math.abs(t.extrastat.pc2)?1:-1};case"outlier":return function(e,t){return e.extrastat.outlier<t.extrastat.outlier?1:-1};default:return function(t,n){if(void 0!==t.scag)return t.scag[e]<n.scag[e]?1:-1}}}function N(e,t,n){var r;if(n)r=t;else{void 0===t.length&&(t=[t]);var i=t.length-1;r=X(i).find(function(e){var n=e.fieldDefs||[e],r=n.length;return(e.fieldDefs||[e]).forEach(function(e){r-=!(void 0===t.find(function(t){return t.field===e.field}))}),!r})}switch(e){case"PC1":return{PC1:(r||t).extrastat.pc1};case"skewness":return{skewness:(r||t).stats.modeskew};case"PC2":return{PC2:(r||t).extrastat.pc2};case"outlier":return{outlier:(r||t).extrastat.outlier};case void 0:var a={};return Z.getsupport(i).types.forEach(function(e){a[e]=N(e,r,!0)[e]}),a;default:var a={};return a[e]=void 0===r?0:r.scag[e],a}}function q(e,t){var n=t[0]||t;e.mark="bar",e.encoding={x:{field:n.field,type:n.type},y:{aggregate:"count",field:"*"}},"quantitative"===n.type?(e.encoding.x.bin={},e.encoding.y.type=n.type):"string"===n.primitiveType?e.encoding.y.type="quantitative":"temporal"===n.type&&(e.encoding.x.bin={},e.encoding.x.timeUnit="year",e.encoding.y.type="quantitative")}function O(e,t){var n=t[0]||t;e.mark="tick",e.encoding={x:{field:n.field,type:n.type}}}function B(e,t){var n=t[0]||t;e.mark="area",e.encoding={x:{field:n.field,type:n.type},y:{aggregate:"count",field:"*"}},"quantitative"===n.type?(e.encoding.x.bin={},e.encoding.y.type=n.type):"string"!==n.primitiveType&&"temporal"!==n.type&&"integer"!==n.primitiveType||(e.encoding.y.type="quantitative")}function U(e,t){var n=t[0]||t;e.mark="boxplot",e.encoding={x:{field:n.field,type:n.type}}}function R(e,t,n){e.mark=n||"point",e.encoding={x:{field:t[0].field,type:t[0].type},y:{field:t[1].field,type:t[1].type}},e.config=e.config||{},e.config.mark={filled:!0,opacity:1}}function L(e,t,n){e.mark="scatter3D",e.encoding={x:{field:t[0].field,type:t[0].type},y:{field:t[1].field,type:t[1].type},column:{field:t[2].field,type:t[2].type}},n&&(e.config.extraconfig=n)}function F(e,t,n){e.mark="radar",e.encoding={x:{field:t[0].field,type:t[0].type},y:{field:t[1].field,type:t[1].type},column:{field:t[2].field,type:t[2].type},row:{field:t[3].field,type:t[3].type}},n&&(e.config.extraconfig=n)}function Q(e,t,n){for(var r=G(e,t),i=!1,o=!1,c=!1,l=0;l<r.encodings.length;l++){var s=r.encodings[l];s.autoCount!==!1&&(a.enumSpec.isEnumSpec(s.field)&&(i=!0),(a.enumSpec.isEnumSpec(s.aggregate)||a.enumSpec.isEnumSpec(s.bin)||a.enumSpec.isEnumSpec(s.timeUnit))&&(o=!0),a.enumSpec.isEnumSpec(s.channel)&&(c=!0))}var p=e.groupBy;return"auto"===e.groupBy&&(p=K.autoGroupBy=i?o?"fieldTransform":"field":"encoding"),{spec:r,groupBy:p,orderBy:[n],chooseBy:["aggregationQuality","effectiveness"],config:{omitTableWithOcclusion:!1,autoAddCount:(i||o||c)&&e.autoAddCount}}}function G(t,n){if(n){t=h.duplicate(t),t.transform&&t.transform.filter&&delete t.transform.filter;var i=s.getVlFilter();i&&(t.transform=t.transform||{},t.transform.filter=i)}return{data:m.data,mark:t.mark===e?"?":t.mark,type:t.type,transform:t.transform,encodings:r.util.keys(t.encoding).reduce(function(e,n){var i=r.util.extend({channel:p.isAnyChannel(n)?"?":n},t.encoding[n],{title:void 0});return a.enumSpec.isEnumSpec(i.field)&&(i.field={name:"f"+n,"enum":i.field["enum"]}),e.push(i),e},[]),config:t.config}}function z(e){var t=h.duplicate(e),r=null;if(t){r=(t.transform||{}).filter;var a=n.omit(t.transform||{},"filter");t=n.omit(t,"transform"),a&&(t.transform=a)}var o=i.util.mergeDeep(y(),t);return o.transform.filter=s.reset(r),o}function H(e,n){var r=t.data.map(function(t){return[t[e],t[n]]});try{var i=scagnostics(r,"leader",20);return isNaN(i.skinnyScore)?{outlying:0,skewed:0,sparse:0,clumpy:0,striated:0,convex:0,skinny:0,stringy:0,monotonic:0,invalid:1}:{outlying:i.outlyingScore,skewed:i.skewedScore,sparse:i.sparseScore,clumpy:i.clumpyScore,striated:i.striatedScore,convex:i.convexScore,skinny:i.skinnyScore,stringy:i.stringyScore,monotonic:i.monotonicScore}}catch(a){return{outlying:0,skewed:0,sparse:0,clumpy:0,striated:0,convex:0,skinny:0,stringy:0,monotonic:0,invalid:1}}}var V=n.keys(g.schema.definitions.Encoding.properties).concat([e+0]),W="#4682b4",j={IDLE:0,GENERATE_GUIDE:1,GENERATE_ALTERNATIVE:2,FREE:3,UPDATEPOSITION:4},Y=10,K={dataencde:null,alternatives:[],autoGroupBy:null,spec:null,firstrun:!0,chart:null,charts:[],mainfield:null,prop:null,dim:0,dataref:[],limit:10,mspec:null,limitup:0,state:j.IDLE};K.mark2plot=k;var Z=[{types:["PC1","PC2","skewness","outlier"],marks:["tick","bar","area","boxplot"],option:"auto",getmark:P},{types:["outlying","skewed","sparse","clumpy","striated","convex","skinny","stringy","monotonic"],marks:["point","hexagon","leader","contour"],option:"random",getmark:P},{types:["outlying","skewed","sparse","clumpy"],marks:["scatter3D-point","scatter3D-evenbin","scatter3D","scatter3D-contour"],option:"auto",getmark:P},{types:["outlying","skewed","sparse"],marks:["radar","radar-evenbin","radar-leader"],option:"auto",getmark:P}];Z.getsupport=function(e){var t=e>Z.length-1?Z.length-1:e;return Z[t]},K.plot=function(e,r){if(!Object.keys(m.data).length)return K;if(!K.firstrun&&t.currentDataset[Object.keys(m.data)[0]]===m.data[Object.keys(m.data)[0]])return K;if(K.firstrun=!1,"undefined"!=typeof e){K.data=[t.schema.fieldSchemas,K.dataref];var i=$(".biplot"),a=n.cloneDeep(e),o={top:20,right:20,bottom:20,left:20},c=i.width()-o.left-o.right,l=i.width()-o.top-o.bottom,s=0*Math.PI,d=d3.scale.category10(),f=d3.scale.linear().range([0,c]),g=d3.scale.linear().range([l,0]),h=2,v={top:5,right:5,bottom:5,left:5},y={w:40-v.left-v.right,h:40-v.top-v.bottom},k=d3.scale.linear().range([v.left,y.w+v.left]).domain([0,1]),w=d3.scale.linear().range([v.top+y.h,v.top]).domain([0,1]),x=d3.select("#bi-plot").attr("width",c+o.left+o.right).attr("height",l+o.top+o.bottom),A=(x.select("#bi-plot"),x.select("#bi-plot-g").attr("transform","translate("+o.left+","+o.top+")"));x.select(".overlay").attr("width",c+o.left+o.right).attr("height",l+o.top+o.bottom).style("fill","none");var C=A.select("#bi-plot-axis"),T=A.select("#bi-plot-point"),D=[],M=[],P=[],_=[],I=null;if(0===r)M=Object.keys(a[0]),P=E(a),_=M.map(function(e,n){var r=0,i=P.map(function(e){return e[n]}),a=ss.quantile(i,.25),o=ss.quantile(i,.75),c=3*(o-a);return t.schema.fieldSchema(e).stats.q1=a,t.schema.fieldSchema(e).stats.q3=o,t.schema.fieldSchema(e).stats.q1iqr=Math.max(a-c,ss.min(i)),t.schema.fieldSchema(e).stats.q3iqr=Math.min(o+c,ss.max(i)),t.schema.fieldSchema(e).stats.iqr=c,i.forEach(function(e){e<a-2*c||e>o+2*c?r+=10:(e<a-c||e>o+c)&&(r+=1)}),r});else{var N=[];if(a.forEach(function(e){for(var t in e[e.field])1!==e[e.field][t].invalid&&(D.push([e.field,t]),N.push(e[e.field][t]))}),a=N.filter(function(e){return!e.invalid}),M=Object.keys(a[0]).filter(function(e){return"label"!==e}),P=a.map(function(e){return d3.values(e)}),M<9){a.forEach(function(e,t){e.label=D[t],e.pc1=0,e.pc2=0}),I=n.cloneDeep(a);var q=M.map(function(e,t){return{brand:e,pc1:0,pc2:0}});K.estimate(q,r,I)}}try{var O=new PCA;P=O.scale(P,!0,!0);var B=O.pca(P,2),U=B[0],R=B[1],L=B[2];a.forEach(function(e,t){e.pc1=U[t][L[0]],e.pc2=U[t][L[1]]}),1==r&&(a.forEach(function(e,t){e.label=D[t]}),I=n.cloneDeep(a),a=M.map(function(e){var t=a.sort(function(t,n){return t[e]<n[e]?1:-1})[0];if(t[e]>.65)return t.feature=e,t}).filter(function(e){return void 0!=e}));var F=[-(1/0),-(1/0)],Q=[1/0,1/0];F=F.map(function(e,t){return d3.max(a.map(function(e){return e["pc"+(t+1)]}))}),Q=Q.map(function(e,t){return d3.min(a.map(function(e){return e["pc"+(t+1)]}))});var G=[0,0];G=G.map(function(e,t){return Math.max(Math.abs(Q[t]),Math.abs(F[t]))}),f.domain([-G[0],G[0]]).nice(),g.domain([-G[1],G[1]]).nice();var z=0;R.forEach(function(e){z=Math.max(z,Math.sqrt(e[0]*e[0]+e[1]*e[1]))});var H=G[0]/z,V=G[1]/z,q=M.map(function(e,t){return{brand:e,pc1:R[t][L[0]]*H,pc2:R[t][L[1]]*V}});a.map(function(e,t){var n=b(e.pc1,e.pc2,s);e.pc1=n.x,e.pc2=n.y,e.vector=P[t]}),q.map(function(e,n){var i=b(e.pc1,e.pc2,s);e.pc1=i.x,e.pc2=i.y,0===r&&(e.outlier=_[n],e.skew=t.schema.fieldSchema(e.brand).stats.modeskew)}),K.estimate(q,r,I);var j=function(e,t){q.forEach(function(t,n){var r={x:0,y:0},i={x:t.pc1,y:t.pc2},a={x:e.pc1,y:e.pc2};t.D=S(r,i,a)}),A.selectAll(".tracer").data(q).enter().append("line").attr("class","tracer tips").attr("x1",function(t,n){return f(e.pc1)}).attr("y1",function(t,n){return g(e.pc2)}).attr("x2",function(e,t){return f(e.D.x)}).attr("y2",function(e,t){return g(e.D.y)}).style("stroke",function(e){return"#ff6f2b"}),delete e.D;var r=n.cloneDeep(e);delete r.pc1,delete r.pc2,delete r.vector;var i=d3.entries(r);le.show(i,"")},Y=x.selectAll(".legendtop").data([""]).enter().append("text").text(function(e){return e}).attr("class","legendtop").attr("text-anchor","end").attr("y",l+o.bottom/2).attr("x",c),Z=function(e,t){a.forEach(function(t,n){var r={x:0,y:0},i={x:e.pc1,y:e.pc2},a={x:t.pc1,y:t.pc2};t.D=S(r,i,a)});var n=A.selectAll(".tracer").data(a).enter();n.append("line").attr("class","tracer tips").attr("x1",function(e,t){return f(e.D.x)}).attr("y1",function(e,t){return g(e.D.y)}).attr("x2",function(e,t){return f(e.pc1)}).attr("y2",function(e,t){return g(e.pc2)}).style("stroke",function(e){return"#aaa"}),n.append("circle").attr("class","tracer-c tips").attr("cx",function(e,t){return f(e.D.x)}).attr("cy",function(e,t){return g(e.D.y)}).attr("r",5).style("fill",function(e){return"#ff6f2b"}).style("fill-opacity",.1),console.log("Mouse over brand"),console.log(e.brand),Y.data([e.brand]).text(function(e){return e})},J=function(e,t){A.selectAll(".tracer").remove(),A.selectAll(".tracer-c").remove(),le.hide(),Y.data([""]).text(function(e){return e})};if(0===r){T.selectAll(".subgraph").remove();var X=T.selectAll(".dot").data(a).attr("cx",function(e){return f(e.pc1)}).attr("cy",function(e){return g(e.pc2)}).style("fill",W).style("stroke","black").style("stroke-width",.2).style("stroke-opacity",.5).style("fill-opacity",.6).on("mouseover",j).on("mouseleave",J);X.exit().remove(),X.enter().append("circle").attr("class","dot").attr("r",h).attr("cx",function(e){return f(e.pc1)}).attr("cy",function(e){return g(e.pc2)}).style("fill",W).style("stroke","black").style("stroke-width",.5).style("fill-opacity",.6).on("mouseover",j).on("mouseleave",J)}else{T.selectAll(".dot").remove();var ee=T.selectAll(".subgraph").data(a).attr("class","subgraph").attr("transform",function(e){return"translate("+(f(e.pc1)-(y.w+v.left+v.right)/2)+","+(g(e.pc2)-(y.h+v.top+v.bottom)/2)+")"}).on("mouseover",j).on("mouseleave",J);ee.exit().remove();var te=ee.enter().append("g").attr("class","subgraph").attr("transform",function(e){return"translate("+(f(e.pc1)-(y.w+v.left+v.right)/2)+","+(g(e.pc2)-(y.h+v.top+v.bottom)/2)+")"}).on("mouseover",j).on("mouseleave",J);te.append("rect").attr("class","backgroundSub").attr("width",y.w+v.left+v.right).attr("height",y.h+v.top+v.bottom).attr("x",0).attr("y",0);var ne=ee.selectAll(".point").data(function(e){var n=t.data.map(function(t){return[t[e.label[0]],t[e.label[1]]]}),r=n.map(function(e){return e[0]}),i=n.map(function(e){return e[1]}),a=d3.max(r),o=d3.min(r),c=d3.max(i),l=d3.min(i);return n.forEach(function(e){e[0]=(e[0]-o)/(a-o),e[1]=(e[1]-l)/(c-l)}),n}).attr("cx",function(e){return k(e[0])}).attr("cy",function(e){return w(e[1])});ne.exit().remove(),ne.enter().append("circle").attr("class","point").attr("r",1).attr("cx",function(e){return k(e[0])}).attr("cy",function(e){return w(e[1])}).style("fill",function(e){return"#4682b4"}).style("opacity",.8)}var re=C.selectAll(".circle_brand").data(q).attr("x",function(e){return f(e.pc1)-2.5}).attr("y",function(e){return g(e.pc2)-2.5}).style("fill",function(e){return d(e.brand)});re.exit().remove(),re.enter().append("rect").attr("class","circle_brand").attr("width",5).attr("height",5).attr("x",function(e){return f(e.pc1)-2.5}).attr("y",function(e){return g(e.pc2)-2.5}).style("fill",function(e){return d(e.brand)});var ie,ae,oe=d3.behavior.drag().on("dragstart",function(e){ae=t.schema.fieldSchema(e.brand);var n=d3.selectAll($("[id='"+e.brand+"']")).select("div"),r={field:ae.field,title:ae.title,type:ae.type,aggregate:ae.aggregate};p.dragStart(r,null);var i=n.select("span").html();ie=d3.select("bi-plot").append("span").html(i),ie.attr("class","pill draggable full-width no-right-margin field-info ng-pristine ng-untouched ng-valid ng-isolate-scope ui-draggable ui-draggable-handle ng-empty ui-draggable-dragging").style("position","absolute").style("z-index","9999").style("left",function(){return(d3.event.x||d3.event.pageX)+"px"}).style("top",function(){var e=(d3.event.y||d3.event.pageY)+100;return e+"px"}),d3.selectAll(".field-drop").attr("class","field-drop ng-pristine ng-untouched ng-valid ui-droppable ng-not-empty ui-dropable-active drop-active "),u.notify()}).on("drag",function(e){ie.style("left",function(){return d3.event.x+"px"}).style("top",function(){return d3.event.y+100+"px"})}).on("dragend",function(e){d3.selectAll("schema-list-item").data(t.schema.fieldSchemas).filter(function(t){return t.field===e.brand}).select("div").attr("class","schema-list-item ng-pristine ng-untouched ng-valid ui-droppable ui-droppable-disabled ng-empty");p.dragStop;var n=ie.node().getBoundingClientRect();ie.remove();var r=d3.selectAll(".shelf-group");r=r[0];var r=r.filter(function(e,t){var r=e.getBoundingClientRect();return r.top<n.top&&r.bottom>n.top&&r.left<n.left&&r.right>n.left});try{var i=$(r[0]).attr("channel-id").replace(/'/g,"");null!=i&&(p.set(i,ae),p.listener.dragDrop(i))}catch(a){}u.notify(),d3.selectAll("div [d3-over='true']").attr("d3-over","false"),d3.selectAll(".field-drop").attr("class","field-drop ng-pristine ng-untouched ng-valid ui-droppable ng-not-empty")}),ce=C.selectAll(".line").data(q).attr("x1",function(e){return f(0)}).attr("y1",function(e){return f(0)}).attr("x2",function(e){return f(e.pc1)}).attr("y2",function(e){return g(e.pc2)}).style("stroke",function(e){return d(e.brand)}).style("stroke-width","1px").on("mouseover",Z).on("mouseleave",J);0==r?ce.on("dblclick",function(e){var t=d3.selectAll($("[id='"+e.brand+"']")).select("div").select("span");$(t[0]).trigger("dblclick")}).call(oe):ce.on("dblclick",function(e){}).on("dragstart",null).on("drag",null).on("dragend",null),ce.exit().remove(),ce.enter().append("line").attr("class","line square draggable").attr("x1",function(e){return f(0)}).attr("y1",function(e){return f(0)}).attr("x2",function(e){return f(e.pc1)}).attr("y2",function(e){
return g(e.pc2)}).style("stroke",function(e){return d(e.brand)}).style("stroke-width","1px").on("mouseover",Z).on("mouseleave",J),0==r?ce.on("dblclick",function(e){var t=d3.selectAll($("[id='"+e.brand+"']")).select("div").select("span");$(t[0]).trigger("dblclick")}).call(oe):ce.on("dblclick",function(e){}).on("dragstart",null).on("drag",null).on("dragend",null);var le=d3.tip().attr("class","d3-tip tips ").offset([10,20]).direction("e").html(function(e,t){var n="";n+="<h3>"+(1==t.length?"Brand ":"")+t+"</h3>",n+="<table>";for(var r=0;r<e.length;r++)"pc1"!=e[r].key&&"pc2"!=e[r].key&&(n+="<tr>",n+="<td>"+e[r].key+"</td>",n+="<td class=pct>"+e[r].value+"</td>");return n+="</table>"});if(A.call(le),C.selectAll(".place-label").remove(),K.dim){var se=C.node();se.parentNode.appendChild(se);var pe=function(){for(var e=1;e>0;)e=0,C.selectAll(".place-label").each(function(){var t=this,n=this.getBoundingClientRect();C.selectAll(".place-label").each(function(){if(this!=t){var r=this.getBoundingClientRect();if(2*Math.abs(n.left-r.left)<n.width+r.width&&2*Math.abs(n.top-r.top)<n.height+r.height){var i=.01*(Math.max(0,n.right-r.left)+Math.min(0,n.left-r.right)),a=.02*(Math.max(0,n.bottom-r.top)+Math.min(0,n.top-r.bottom)),o=d3.transform(d3.select(this).attr("transform")),c=d3.transform(d3.select(t).attr("transform"));e+=Math.abs(i)+Math.abs(a),c.translate=[c.translate[0]+i,c.translate[1]+a],o.translate=[o.translate[0]-i,o.translate[1]-a],d3.select(this).attr("transform","translate("+o.translate+")"),d3.select(t).attr("transform","translate("+c.translate+")"),n=this.getBoundingClientRect()}}})})},ue=[];q.forEach(function(e,t){var n=g(e.pc2);n+=e.pc2<0?15:-5,ue.push({x:f(e.pc1),y:n,label:e.brand,anchor:e.pc1<0?"end":"start"})});C.selectAll(".place-label").data(ue).enter().append("text").attr("class","place-label").attr("text-anchor",function(e){return e.anchor}).attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).text(function(e){return e.label.replace("Score","")}).style("fill",function(e){return d(e.label)}).style("font-weight","bold");pe()}K.dataencde=a}catch(de){console.log("Not enough dimension")}}return K},K.estimate=function(e,n,r){if(0===n){K.charts.length=0,t.schema.fieldSchemas.forEach(function(t){var n=e.find(function(e){return e.brand===t.field});t.extrastat={pc1:n.pc1,pc2:n.pc2,outlier:n.outlier}});var i=[],a=e.sort(function(e,t){return Math.abs(e.pc1)<Math.abs(t.pc1)?1:-1})[0].brand;e.sort(function(e,t){return Math.abs(e.pc2)<Math.abs(t.pc2)?1:-1});var o=e[0].brand!==a?e[0].brand:e[1].brand;i.push(a),i.push(o),t.schema.fieldSchemas.sort(function(e,t){return Math.abs(e.stats.modeskew)>Math.abs(t.stats.modeskew)?-1:1});var c=t.schema.fieldSchemas.filter(function(e){var t=!1;return i.forEach(function(n){t|=n!==e}),t})[0];t.schema.fieldSchemas.sort(function(e,t){return e.extrastat.outlier<t.extrastat.outlier?1:-1});var l=t.schema.fieldSchemas.filter(function(e){var t=!1;return i.forEach(function(n){t|=n!==e}),t})[0],s=t.schema.fieldSchema(a),p=t.schema.fieldSchema(o);x([s],"PC1"),x([p],"PC2"),x([c],"skewness"),x([l],"outlier")}else{K.charts.length=0,K.dataref=r.map(function(e){return{fieldDefs:[t.schema.fieldSchema(e.label[0]),t.schema.fieldSchema(e.label[1])],scag:e}});var u={},d=e.map(function(e){var n=e.brand,i=r.sort(function(e,t){return e[n]<t[n]?1:-1})[0].label;if(void 0===u[i[0]]||void 0===u[i[0]][i[1]]){u[i[0]]={}||u[i[0]];var a={type:n,fieldDefs:[t.schema.fieldSchema(i[0]),t.schema.fieldSchema(i[1])]};return u[i[0]][i[1]]=a,{fields:a.fieldDefs,type:n,dataref:K.dataref,score:r[0][n]}}});d.sort(function(e,t){return e.score<t.score?1:-1}),ee=0;for(var f=0;f<(d.length>4?4:d.length);f++)x(d[f].fields,d[f].type,K.dataref)}};var J=function(e,t){if(this){var r={level_explore:e.dim,abtraction:e.mark,visual_feature:e.type};c.logInteraction(c.actions.GUIDEPLOT_SELECT,this.shorthand,{val:{PS:r,spec:this.vlSpec,query:this.query},time:(new Date).getTime()})}K.types=Z[e.dim].types,K.marks=Z[e.dim].marks;var i=e.fieldDefs.map(function(e){return e.field});e.charts=(e.dim>1?[e.fieldDefs]:X(e.dim).sort(e.ranking)).map(function(t){var n=e.plot(t.fieldDefs||t,e.mark,e.mspec);return n.vlSpec.config.typer={type:e.type,val:e.dim>1?0:N(void 0,t.fieldDefs||t)},n}),e.previewcharts=e.charts.map(function(t){var r=n.cloneDeep(t),i={};return i[e.type]=t.vlSpec.config.typer.val[e.type],r.vlSpec.config={cell:{width:e.dim?100:200,height:e.dim?100:30},axis:{grid:!1,labels:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0},displayModeBar:!1,colorbar:!1,typer:{type:e.type,val:i}},"temporal"!==t.fieldSet[0].type&&(r.vlSpec.config.axis.ticks=!1),r});var a=0;a=T(i,e.charts),K.prop.mspec=e.charts[a],e.pos=a,K.updateguide(e)},X=function(e){if(e<2)return K.data[e>1?1:e];var t=w(K.data[0],0,0,e,[],[]);return t};K.prop2spec=function(e){K.state=j.GENERATE_GUIDE,K.prop=e,p.select(e.mspec.vlSpec)},K.madeprop=function(e){var t=K.prop.type,n=K.prop.dim,r=K.prop.mark,i={mspec:e,type:t,mark:r,ranking:I(t),plot:te,fieldDefs:K.prop.fieldDefs,dim:n};switch(K.state){case j.GENERATE_GUIDE:K.limitup=1/0,J(i);var a={level_explore:i.dim,abtraction:i.mark,visual_feature:i.type};c.logInteraction(c.actions.EXPANDED_SELECT,this.shorthand,{val:{PS:a,spec:this.vlSpec,query:this.query},time:(new Date).getTime()}),K.limit=Y;case j.GENERATE_ALTERNATIVE:K.alternativeupdate(),K.state=j.FREE;default:return}},K.checkRender=function(e,t){var n=A(e,t),r=M(n.type,n.dim,K.dim);if(null!=K.prop){if(e.mark!==K.prop.mark||K.dim!==K.prop.dim)K.state=j.GENERATE_GUIDE,K.dim===K.prop.dim&&"__ANY__"!==n.mark||(C(n.mark,n.dim)&&(e.mark=_(r,n.dim)),K.prop.dim=K.dim,K.prop.mark=e.mark,K.prop.type=r,e.type=r),K.prop.fieldDefs=n.fieldDefs;else if(K.state===j.FREE){var i=T(t);if(console.log("position find:"+i),K.prop.pos!==i){if(i===-1)return K.state=j.GENERATE_GUIDE,void(K.prop.fieldDefs=n.fieldDefs);K.prop.pos=i,i>K.limit&&(K.limitup=i-2,K.limit=Y),K.prop.mspec=K.prop.charts[K.prop.pos]}K.state=j.GENERATE_ALTERNATIVE,K.prop.fieldDefs=n.fieldDefs}}else t.length&&(K.state=j.GENERATE_GUIDE,e.mark=_(r,K.dim),e.type=r,K.prop={},K.prop.mark=e.mark,K.prop.type=r,K.prop.fieldDefs=n.fieldDefs,K.prop.dim=K.dim);return e},K.alternativeupdate=function(e){if(e=n.cloneDeep(e||K.prop.mspec),0===K.dataref.length||null==K.dataref){var r=[],i=[],o=[];r=K.data[0].map(function(e){var t={field:e.field};return t[e.field]=e.scag,t});var c=[];r.forEach(function(e){for(var t in e[e.field])o.push([e.field,t]),c.push(e[e.field][t])}),r=c,r.forEach(function(e,t){e.label=o[t]}),i=n.cloneDeep(r),K.dataref=i.map(function(e){return{fieldDefs:[t.schema.fieldSchema(e.label[0]),t.schema.fieldSchema(e.label[1])],scag:e}}),K.data[1]=K.dataref}var l=e.fieldSet.map(function(e){return e.field}).filter(function(e){return"count"!=e&&"*"!=e});if(l.length>2)return void(K.alternatives=[{charts:[]}]);if(0===l.length)return void(K.alternatives.length=0);if(l.length<2){var s=X(1).filter(function(e){var t=!0;return l.forEach(function(n){var r=!1;e.fieldDefs.forEach(function(e){r=r||e.field===n}),t=t&&r}),t});if(0!==s.length){var p=Z[K.dim+1].types.map(function(e){return s.sort(function(t,n){return t.scag[e]<n.scag[e]?1:-1})[0]}),u=[],d=[];p.forEach(function(e,t){0===u.filter(function(t){return t===e}).length&&(u.push(e),d.push(Z[K.dim+1].types[t]))});var m=d.map(function(e,t){return{v:u[t],type:e}}).map(function(n){var r={};r.type=n.type,r.config={axis:{grid:!1,ticks:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0}},k(D(e.vlSpec.mark,K.dim),r,n.v.fieldDefs);var i=Q(r,void 0,n.type),o=a.query(i,t.schema);K.query=o.query;var c=o.result.getTopSpecQueryModel(),l=f.getChart(c);return l.query={groupBy:"encoding",orderBy:["feature"],chooseBy:["abstraction"]},l});K.alternatives=[{charts:m}]}else K.alternatives.length=0}else{var s=X(l.length-1).filter(function(e){var t=!1;return l.forEach(function(n){var r=!1;e.fieldDefs.forEach(function(e){r=r||e.field===n}),t=t||r}),t});s=s.filter(function(e){var t=!0;return l.forEach(function(n){var r=!1;e.fieldDefs.forEach(function(e){r=r||e.field===n}),t=t&&r}),!t});var p=Z[1].types.map(function(e){return s.sort(function(t,n){return t.scag[e]<n.scag[e]?1:-1})[0]}),u=[],d=[];p.forEach(function(e,t){if(0===u.filter(function(t){return t.fieldDefs===e.fieldDefs}).length){u.push(JSON.parse(JSON.stringify(e)));var n=Z.getsupport(l.length-1),r=n.types.length;d.push(n.types[t>r?r-1:t])}}),u.forEach(function(e,n){var r="",i=l.map(function(e){return r=r+"-"+e,t.schema.fieldSchema(e)});Array.prototype.push.apply(i,e.fieldDefs.filter(function(e){var t=!0;return l.forEach(function(n){t=t&&n!==e.field}),t&&(r=r+"-"+e.field),t})),e.label=r,e.type=d[n],e.fieldDefs=i}),u=n.uniqBy(u,"label");var m=u.map(function(e,t){return{v:e,type:e.type}}).map(function(n){var r={};r.type=n.type,r.config={axis:{grid:!1,ticks:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0}},k(D(e.vlSpec.mark,K.dim),r,n.v.fieldDefs);var i=Q(r,void 0,n.type),o=a.query(i,t.schema);K.query=o.query;var c=o.result.getTopSpecQueryModel(),l=f.getChart(c);return l.query={groupBy:"encoding",orderBy:["feature"],chooseBy:["abstraction"]},l});K.alternatives=[{charts:m}]}},K.updateSpec=function(e){K.types=Z[e.dim].types,K.marks=Z[e.dim].marks;var r=n.cloneDeep(e);r.ranking=I(e.type),k(e.mark,r.mspec,t.schema.fieldSchemas.slice(0,e.dim+1)),r.charts.length=0;var i=e.dim>1?[e.fieldDefs]:X(r.dim);r.charts=i.sort(r.ranking).map(function(t){var n=te(t.fieldDefs||t,r.mark,r.mspec);return n.vlSpec.config.typer={type:e.type,val:N(void 0,t.fieldDefs||t)},n}),r.previewcharts=r.charts.map(function(t){var i=n.cloneDeep(t),a={};return a[e.type]=t.vlSpec.config.typer.val[e.type],i.vlSpec.config={cell:{width:100,height:r.dim?100:30},axis:{grid:!1,labels:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0},displayModeBar:!1,colorbar:!1,typer:{type:e.type,val:a}},i.query={groupBy:"encoding",orderBy:["feature"],chooseBy:["abstraction"]},"temporal"!==t.fieldSet[0].type&&(i.vlSpec.config.axis.ticks=!1),i});var a=r.fieldDefs.map(function(e){return e.field});r.pos=T(a,r.charts),r.mspec=r.charts[r.pos],K.updateguide(r),p.select(r.mspec.vlSpec)};var ee=0,te=function(e,r,i){var o=n.cloneDeep(i);o.config={overlay:{line:!0},scale:{useRawDomain:!0}},k(r,o,e);var c=Q(o,void 0,r),l=a.query(c,t.schema),s=l.result.getTopSpecQueryModel(),p=f.getChart(s);return p.query={groupBy:"encoding",orderBy:["feature"],chooseBy:["abstraction"]},p};return K.parseSpec=function(e){K.spec=z(e)},K.updateguide=function(e){e=n.cloneDeep(e||K.prop),e.mspec.config={},K.prop=e,K.limitup=K.prop.pos>K.limit-1?K.prop.pos-2:0,K.mspec=e.mspec},K.calscagnotic=function(e){e.forEach(function(e){t.schema.fieldSchemas.forEach(function(n){if(!(n.field===e||void 0!=t.schema._fieldSchemaIndex[e].scag&&void 0!==t.schema._fieldSchemaIndex[e].scag[n.field]||void 0!==n.scag&&void 0!==n.scag[e])){var r=H(e,n.field);void 0===t.schema.fieldSchema(e).scag&&(t.schema.fieldSchema(e).scag={}),t.schema.fieldSchema(e).scag[n.field]=r}})})},K.updateAlternative=function(e,t){},K.mark2mark=D,K.reset=function(e){var t=y();t.transform.filter=s.reset(null,e),K.spec=t,K.firstrun=!0,K.charts.length=0,K.chart=null,K.prop=null,K.alternatives=[],K.dataref=[],K.mspec=null,K.state=j.IDLE},K.reset(),t.onUpdate.push(function(){K.reset(!0)}),K}]),angular.module("vlui").service("GuidePill",["Dataset",function(e,t){function n(e){}function r(e){return i.pills[e]}var i={get:r,set:n,pills:{},listener:null};return["add","select","preview","update","reset","sort"].forEach(function(e){i[e]=function(){if(i.listener&&i.listener[e])return i.listener[e].apply(null,arguments)}}),i}]),angular.module("pcagnosticsviz").controller("MainCtrl",["$scope","$document","Spec","Dataset","Wildcards","Config","consts","Chronicle","Logger","Bookmarks","Modals","FilterManager","NotifyingService","PCAplot",function(e,t,n,r,i,a,o,c,l,s,p,u,d,f){e.Spec=n,e.contain={"bi-plot":"Overview",div:[{key:"guideplot",val:"Exemplar"},{key:"thumplot",val:"Feature pannel"},{key:"slideGraph",val:"Mainview view"},{key:"alternatives-pane",val:"Expanded views"},{key:"guidemenu",val:"Feature pannel"}],h3:"headertext",body:"body"},e.Dataset=r,e.Wildcards=i,e.Config=a,e.Logger=l,e.Bookmarks=s,e.FilterManager=u,e.consts=o,e.showDevPanel=!1,e.embedded=!!o.embeddedData,e.hideExplore=!1,e.fieldShow=!1,e.WildcardsShow=!1,e.PCAplot=f,e.showEncoding=!1,e.showExtraGuide=!1,e.fieldAdd=function(e){Pills.add(e)},e.toggleHideExplore=function(){e.hideExplore=!e.hideExplore,e.hideExplore?l.logInteraction(l.actions.TOGGLE_HIDE_ALTERNATIVES,n.chart.shorthand):l.logInteraction(l.actions.TOGGLE_SHOW_ALTERNATIVES,n.chart.shorthand)},e.alternativeType=null,e.setAlternativeType=function(t,r){e.alternativeType=t,r||(e.hideExplore=!1,l.logInteraction(l.actions.TOGGLE_SHOW_ALTERNATIVES,n.chart.shorthand),l.logInteraction(l.actions.SET_ALTERNATIVES_TYPE,t,{shorthand:n.chart.shorthand}))},e.onMouseOverLog=function(t){var n=void 0;t.originalEvent.path.find(function(t){if("div"==t.tagName.toLowerCase()){var r=e.contain.div.find(function(e){return t.classList.contains(e.key)});return n=void 0==r?void 0:r.val,r}return n=e.contain[t.tagName.toLowerCase()]}),"body"!=n&&l.logInteraction(l.actions.MOUSE_OVER,n,{val:{region:n,position:{screenX:t.screenX,screenY:t.screenY}},time:new Date})},e.scrollToTop=function(){t.find(".vis-pane-container").scrollTop(0)},e.groupByChanged=function(){l.logInteraction(l.actions.GROUP_BY_CHANGED,n.spec.groupBy)},e.autoAddCountChanged=function(){l.logInteraction(l.actions.AUTO_ADD_COUNT_CHANGED,n.spec.autoAddCount)},e.$watch("Spec.alternatives",function(t){for(var n=0;n<t.length;n++)if(e.alternativeType===t[n].type)return;e.setAlternativeType(null,!0)}),e.$watch(function(){return f.mspec},function(e){console.log("logging...."),console.log(e)}),e.canUndo=!1,e.canRedo=!1,e.showModal=function(e){p.open(e),"bookmark-list"==e&&l.logInteraction(l.actions.BOOKMARK_OPEN)},s.isSupported&&s.load(),e.embedded&&(r.dataset={values:o.embeddedData,name:"embedded"}),d.subscribe(e,function(){e.$apply()}),r.update(r.dataset).then(function(){a.updateDataset(r.dataset),o.initialSpec&&(n.parseSpec(o.initialSpec),f.parseSpec(o.initialSpec)),e.chron=c.record("Spec.spec",e,!0,["Dataset.dataset","Config.config","FilterManager.filterIndex"]),e.canUndoRedo=function(){e.canUndo=e.chron.canUndo(),e.canRedo=e.chron.canRedo()},e.chron.addOnAdjustFunction(e.canUndoRedo),e.chron.addOnUndoFunction(e.canUndoRedo),e.chron.addOnRedoFunction(e.canUndoRedo),e.chron.addOnUndoFunction(function(){l.logInteraction(l.actions.UNDO)}),e.chron.addOnRedoFunction(function(){l.logInteraction(l.actions.REDO)}),angular.element(t).on("keydown",function(t){return t.keyCode!=="Z".charCodeAt(0)||!t.ctrlKey&&!t.metaKey||t.shiftKey?t.keyCode==="Y".charCodeAt(0)&&(t.ctrlKey||t.metaKey)?(e.chron.redo(),e.$digest(),!1):t.keyCode==="Z".charCodeAt(0)&&(t.ctrlKey||t.metaKey)&&t.shiftKey?(e.chron.redo(),e.$digest(),!1):void 0:(e.chron.undo(),e.$digest(),!1)})})}]),angular.module("pcagnosticsviz").service("Alternatives",["ANY","vl","cql","util","Chart","Dataset",function(e,t,n,r,i,a){function o(e,t,n){var i={type:"histograms",title:"Univariate Summaries",limit:20,query:h(e)};return[r.extend(i,{charts:l(i,t,n)})]}function c(e,r,i){var a=n.query.spec.isAggregate(e.spec),o=[],c=!1;e.spec.encodings.forEach(function(e){e.type===t.type.TEMPORAL&&(c=!0)});var s=r.vlSpec,p=!s.encoding.x||!s.encoding.y,u=s.encoding.color||s.encoding.size||s.encoding.shape||s.encoding.opacity,d=!s.encoding.row||!s.encoding.column;return a||o.push({type:"summarize",title:"Summaries",filterGroupBy:S,limit:2}),p&&o.push({type:"addQuantitativeField",title:"Add Quantitative Field"}),!p&&u||o.push({type:"addCategoricalField",title:"Add Categorical Field"}),p||u||o.push({type:"addQuantitativeField",title:"Add Quantitative Field"}),!c&&p&&o.push({type:"addTemporalField",title:"Add Temporal Field"}),o.push({type:"alternativeEncodings",title:"Alternative Encodings",filterGroupBy:y}),!p&&u&&d&&o.push({type:"addCategoricalField",title:"Add Categorical Field"}),o.map(function(t){return t.query=v[t.type](e),t.charts=l(t,r,i),t})}function l(e,t,r){var o=n.query(e.query,a.schema);return o.result.items.filter(function(n){var i=n.getTopSpecQueryModel();return!t||!t.shorthand||i.toShorthand(e.filterGroupBy)!==r.toShorthand(e.filterGroupBy)}).map(i.getChart)}function s(e){return n.enumSpec.isEnumSpec(e)?e:n.enumSpec.SHORT_ENUM_SPEC}function p(e){var t=r.duplicate(e.spec);return t.mark=s(t.mark),t.encodings.forEach(function(e){e.channel=s(e.channel)}),{spec:t,groupBy:"encoding",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"]}}function u(e){var i=r.duplicate(e.spec);return i.mark=s(i.mark),i.encodings=i.encodings.reduce(function(e,r){if(n.enumSpec.isEnumSpec(r.type))r.aggregate=s(r.aggregate),r.bin=s(r.bin),r.timeUnit=s(r.timeUnit);else switch(r.type){case t.type.Type.QUANTITATIVE:if("count"===r.aggregate)return e;r.aggregate=s(r.aggregate),r.bin=s(r.bin),r.hasFn=!0;break;case t.type.Type.TEMPORAL:r.timeUnit=s(r.timeUnit)}return e.concat(r)},[]),{spec:i,groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0,omitRaw:!0}}}function d(e){var i=r.duplicate(e.spec);return i.mark=s(i.mark),i.encodings=i.encodings.filter(function(e){return"count"!==e.aggregate}).map(function(e){return(n.enumSpec.isEnumSpec(e.type)||e.type===t.type.Type.QUANTITATIVE)&&(delete e.aggregate,delete e.bin),e}),{spec:i,groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!1,omitAggregate:!0}}}function f(e){var i=r.duplicate(e.spec);return i.encodings.push({channel:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,type:t.type.Type.NOMINAL}),{spec:i,groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}}}function m(e){var i=r.duplicate(e.spec);return i.encodings.push({channel:n.enumSpec.SHORT_ENUM_SPEC,bin:n.enumSpec.SHORT_ENUM_SPEC,aggregate:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,type:t.type.Type.QUANTITATIVE}),{spec:i,groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}}}function g(e){var i=r.duplicate(e.spec);return i.encodings.push({channel:n.enumSpec.SHORT_ENUM_SPEC,hasFn:!0,timeUnit:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,type:t.type.Type.TEMPORAL}),{spec:i,groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}}}function h(e){return{spec:{data:e.spec.data,mark:n.enumSpec.SHORT_ENUM_SPEC,transform:e.spec.transform,encodings:[{channel:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,bin:n.enumSpec.SHORT_ENUM_SPEC,timeUnit:n.enumSpec.SHORT_ENUM_SPEC,type:n.enumSpec.SHORT_ENUM_SPEC},{channel:n.enumSpec.SHORT_ENUM_SPEC,field:"*",aggregate:t.aggregate.AggregateOp.COUNT,type:t.type.Type.QUANTITATIVE}]},groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!1}}}var v={alternativeEncodings:p,summarize:u,disaggregate:d,addCategoricalField:f,addQuantitativeField:m,addTemporalField:g,histograms:h,getHistograms:o,getAlternatives:c},y=[n.property.Property.FIELD,n.property.Property.AGGREGATE,n.property.Property.BIN,n.property.Property.TIMEUNIT,n.property.Property.TYPE,{property:n.property.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}],S=[n.property.Property.FIELD,n.property.Property.AGGREGATE,n.property.Property.BIN,n.property.Property.TIMEUNIT,n.property.Property.TYPE];return v}]),angular.module("pcagnosticsviz").run(["$templateCache",function(e){e.put("components/configurationeditor/configurationeditor.html","<form><pre>{{ Config.config | compactJSON }}</pre></form>"),e.put("components/cqlQueryEditor/cqlQueryEditor.html",'<div class="card scroll-y abs-100 vflex"><div><div class="right command"><a ui-zeroclip="" zeroclip-model="Spec.query | compactJSON">Copy</a></div><h3>CompassQL Query</h3></div><textarea class="cqlquery flex-grow-1 full-height" json-input="" type="text" ng-model="Spec.cleanQuery"></textarea></div>'),e.put("components/d3-biplot/bi-plot.html",'<svg id="bi-plot" width="100%" class="biplot"><g id="#bi-plot"></g><rect class="overlay"></rect><g id="bi-plot-g"><g id="bi-plot-axis"></g><g id="bi-plot-point"></g></g></svg>'),e.put("components/d3-guideplot/gplot.html",'<div class="gplot" ng-click="explore()"><svg class="gplotSvg" id="gplot{{pcaDef}}"></svg></div>'),e.put("components/d3-guideplot/guide-plot.html",'<div id="guide-plot-group" class="guideplot"><g-plot ng-repeat="pcaDef in pcaDefs" pca-def="pcaDef" id="{{pcaDef}}"></g-plot></div>'),e.put("components/d3-slidegraph/slide-com.html",'<li class="item wrap"><vl-plot-group class="item" chart="chart" show-bookmark="true" show-debug="false" show-select="false" show-axis-prop="false" show-sort="false" show-transpose="false" enable-pills-preview="true" always-scrollable="false" overflow="false" show-label="false" tooltip="true" toggle-shelf="true"></vl-plot-group></li>'),e.put("components/d3-slidegraph/slide-graph.html",'<div class="slideGraph card no-top-margin"><h2>Focus view</h2><div class="wrap"><button class="butSlider" ng-click="prev()"><i class="fa fa-angle-double-up"></i></button><div class="scroller"><ul class="items-slider"><slide-com ng-repeat="chart in charts | limitTo: limit : limitup" chart="chart"></slide-com></ul></div><button class="butSlider" ng-click="next()"><i class="fa fa-angle-double-down"></i></button></div></div>'),e.put("components/guidemenu/guideMenu.html",'<div class="contain"><div class="sidebar-header"><h2>Navigation</h2><div class="features"><div id="typeselectcontain"><label for="typeselect">Feature type</label><select class="typeselect" id="typeselect" ng-model="prop.type" ng-options="type for type in props" ng-change="typeChange()"></select></div><div><label for="markselect">Mark</label><select class="markselect" id="markselect" ng-model="prop.mark" ng-options="type for type in marks" ng-change="markChange()"></select></div></div></div><div class="thum"><div class="scroll-y"><vl-plot-group ng-if="prop.previewcharts" class="main-vl-plot-group card thumplot no-shrink" ng-class="{\'square\':prop.dim, \'active\': prop.pos== $index + limitup}" ng-repeat="chart in prop.previewcharts| limitTo: limit : limitup" ng-click="previewSlider($index)" chart="chart" show-bookmark="false" show-debug="false" show-select="false" show-axis-prop="true" show-sort="false" show-transpose="false" enable-pills-preview="true" always-scrollable="false" overflow="false" show-label="false" tooltip="true" toggle-shelf="false" priority="priority * $index"></vl-plot-group><a ng-click="increaseLimit()"><div class="vis-list-more" ng-show="limit < prop.previewcharts.length">Load more...</div></a></div></div></div>'),e.put("components/vgSpecEditor/vgSpecEditor.html",'<div class="card scroll-y abs-100 vflex no-right-margin"><div><div class="right"><a class="command" ui-zeroclip="" zeroclip-model="Spec.chart.vgSpec | compactJSON">Copy</a><lyra-export></lyra-export></div><h3>Vega Specification</h3></div><textarea class="vgspec flex-grow-1" json-input="" disabled="disabled" type="text" ng-model="Spec.chart.vgSpec"></textarea></div>'),e.put("app/main/main.html",'<div ng-controller="MainCtrl" class="flex-root vflex full-width full-height" ng-mousedown="onMouseDownLog($event)" ng-mouseenter="onMouseEnterLog($event)" ng-mouseover="onMouseOverLog($event)"><div class="full-width no-shrink"><div class="card top-card no-right-margin no-top-margin"><div class="hflex"><div id="logo" ng-click="Logger.export()"></div><div class="pane"><div class="controls"><a ng-show="Bookmarks.isSupported" class="command" ng-click="showModal(\'bookmark-list\')"><i class="fa fa-bookmark"></i> Bookmarks ({{Bookmarks.list.length}})</a> <a class="command" ng-click="chron.undo()" ng-class="{disabled: !canUndo}"><i class="fa fa-undo"></i> Undo</a> <a class="command" ng-click="chron.redo()" ng-class="{disabled: !canRedo}"><i class="fa fa-repeat"></i> Redo</a></div></div></div></div><alert-messages></alert-messages></div><div class="hflex full-width main-panel grow-1"><div class="pane data-pane noselect"><div class="card no-top-margin data-card abs-100 modifedside"><div class="sidebar-header" ng-if="!embedded"><h2>Data</h2><dataset-selector class="right"></dataset-selector><div class="current-dataset" title="{{Dataset.currentDataset.name}}"><i class="fa fa-database"></i> <span class="dataset-name">{{Dataset.currentDataset.name}}</span></div></div><h3>Overview</h3><bi-plot></bi-plot><h3>Exemplar</h3><div class="scroll-y-nox scroll-y"><vl-plot-group ng-if="PCAplot.chart" class="main-vl-plot-group card no-shrink guideplot" ng-repeat="chart in PCAplot.charts" ng-class="{square: PCAplot.dim}" ng-click="PCAplot.prop2spec(chart.prop)" chart="chart" show-bookmark="false" show-debug="false" show-select="true" show-axis-prop="false" show-sort="false" show-transpose="false" enable-pills-preview="true" always-scrollable="false" overflow="false" show-label="false" tooltip="true" toggle-shelf="false" style="margin-top: 0px; margin-bottom: 5px;"></vl-plot-group><div class="hflex full-width"><h3>Fields</h3><div class="header-drop active"><i class="fa fa-caret-down droplist" ng-click="fieldShow = !fieldShow"></i></div></div><div ng-show="fieldShow"><schema-list field-defs="Dataset.schema.fieldSchemas" order-by="Dataset.fieldOrder" show-count="true" filter-manager="FilterManager" show-add="true"></schema-list></div><div ng-show="WildcardsShow"><schema-list field-defs="Wildcards.list" show-add="true" show-drop="true"></schema-list></div></div></div>Ma</div><div class="pane encoding-pane"><shelves spec="Spec.spec" filter-manager="FilterManager" preview="false" support-any="true"></shelves><shelves class="preview" ng-show="Spec.previewedSpec" spec="Spec.previewedSpec || Spec.emptySpec" preview="true" support-any="true"></shelves></div><button class="toggleEncoding" ng-show="PCAplot.prop" ng-click="showEncoding=!showEncoding"></button><div class="pane vis-pane"><div class="vis-pane-container abs-100" ng-class="{\'scroll-y\': !hideExplore || !Spec.isSpecific, \'no-scroll-y\': hideExplore && Spec.isSpecific}"><slide-graph ng-if="PCAplot.prop.charts" charts="PCAplot.prop.charts" pos="PCAplot.prop.pos" limitup="PCAplot.limitup" limit="PCAplot.limit"></slide-graph><div class="alternatives-pane card" ng-class="{collapse: hideExplore}" ng-if="Spec.isSpecific"><div class="alternatives-header"><div class="right alternatives-jump"><a class="toggle-hide-explore" ng-click="toggleHideExplore()"><span ng-show="hideExplore">Show <i class="fa fa-toggle-up"></i></span> <span ng-show="!hideExplore">Hide <i class="fa fa-toggle-down"></i></span></a></div><h2>Expanded views</h2></div><div class="alternatives-content" ng-if="!hideExplore"><vl-plot-group-list ng-repeat="alternative in PCAplot.alternatives" ng-if="alternative.charts.length > 0 && (!$parent.alternativeType || $parent.alternativeType === alternative.type)" id="alternatives-{{alternative.type}}" list-title="alternative.title" charts="alternative.charts" enable-pills-preview="true" priority="$index * 1000" initial-limit="alternative.limit || null" post-select-action="$parent.scrollToTop()" show-query-select="true" query="alternative.query"></vl-plot-group-list></div></div></div></div><div class="pane guidemenu grow-1" ng-if="showExtraGuide||PCAplot.prop"><guide-menu prop="PCAplot.prop" priority="2" marks="PCAplot.marks" props="PCAplot.types" limitup="PCAplot.limitup" limit="PCAplot.limit"></guide-menu></div></div><div class="hflex full-width dev-panel" ng-if="showDevPanel"><div class="pane" ng-show="consts.logToWebSql"><div class="card"><div>userid: {{Logger.userid}}</div><button ng-click="Logger.clear()">Clear logs</button><br><button ng-click="Logger.export()">Download logs</button></div></div><div class="pane config-pane"><div class="card scroll-y abs-100"><configuration-editor></configuration-editor></div></div><div class="pane vl-pane"><cql-query-editor></cql-query-editor></div><div class="pane vg-pane"><vg-spec-editor></vg-spec-editor></div></div><bookmark-list highlighted="Fields.highlighted" post-select-action="scrollToTop"></bookmark-list><dataset-modal></dataset-modal></div>')}]);